<h1><%= @game.name %></h1>

<div>
	<table class="facts">
		<tr>
			<td class="key">Beginn:</td>
			<td><%=h @game.date_formatted %></td>
		</tr>
		<tr>
			<td class="key">Ende:</td>
			<td><%=h @game.end_date_formatted %></td>
		</tr>
		<tr>
			<td class="key">Ort:</td>
			<td><%=link_to @game.location.name, location_on_map_path(:id => @game.location.id) %></td>
		</tr>
		<tr>
			<td class="key">Resultat:</td>
			<td><%=h @game.result %></td>
		</tr>
	</table>
</div>

<div style="margin-top: 20px;">
<% if !@game.score.blank? %>
	<h2>Skorer Liste</h2>
	<% if @scores.empty? %>

		Zu diesem Spiel wurden keine Skorerpunke erfasst.

	<% else %>

	<%= render :partial => "/scores/score_table", :locals => {:scores => @scores, :game => @game } %>
	
	<% end %>
<% end %>

</div>

<% if logged_in? %>
<div style="margin-top:">
	<h2>Kommentare</h2>
	
	<div>
		<% if @comments.size > 0 %>
		
		<% @comments.each do |c| %>
			<div class="comment">
				<div class="user-comment-thumbnail">
					<%= link_to user_profile_pic(c.user) , player_path(c.user.player) %>
				</div>

				<div class="user-comment">
					<div class="user-comment-heading">
					<%= link_to "#{c.user}", c.user.player %> 
					<span class="comment-timestamp">(<%= l(c.created_at, :format => :default) %>)</span>
					</div>
					<%=h c.comment %>
				</div>
				
				
			</div>
		<% end %>
		
		<% else %>
			<div style="margin-bottom: 10px;">
				Zur Zeit gibt es zu diesem Spiel keine Kommentare.
			</div>
		<% end %>
		
		<div class="comment-input">
			<% form_for @comment, :url => add_comment_game_path do |f| %>
			<%= f.text_area :comment %>
			
			<div class="comment-submit">
				<%= f.submit "Kommentieren" %>
			</div>
			<% end %>
		</div>
		
	</div>
	
</div>
<% end %>
	
<div style="margin-top: 20px;">
	<h2>Besetzung</h2>
	
	<% if !@players.empty? %>
		
		<div style="margin-top: 5px;">
			<%= summary_sentence(@game.players) %>
		</div>
		
		<div style="margin-top: 5px;">
			<%= render :partial => "players/roster", 
				:locals => {
					:players => @players, 
					:editable => false, 
					:deletable => true,
					:delete_icon => "icons/cross.png",
					:delete_path => "/events/#{@game.id}/remove_player?p_id="
				} %>
		</div>
	<% else %>
		Für dieses Spiel haben sich keine Spieler eingetragen.
	<% end %>
</div>

<% content_for :sub_menu do %>
	<% if permitted_to? :manage, :games %>
	<li class="side_bar"><%= link_to "Spiel Details anpassen", edit_game_path(@game) %></li>
	<% end %>
	<% if permitted_to? :manage, :games %>
	<li class="side_bar"><%= link_to_function "Spieler hinzufügen", "Glacier.Popup.init('" + add_player_event_path(@game) + ".ajax', {width: 500})" %></li>
	<% end %>
	<% if !@game.score.blank? && permitted_to?(:manage, :scores) %>
		<li class="side_bar"><%= link_to_function "Skorer erfassen", "Glacier.Popup.init('" + new_game_score_path(:game_id => @game.id) + ".ajax', {width: 500})" %></li>
	<% end %>
	<li class="side_bar"><%= link_to 'Zurück', games_path %></li>
<% end %>

<script type="text/javascript" charset="utf-8">
	Glacier.Utilities.Forms.inputWithDefaultValue('comment_comment');
</script>

